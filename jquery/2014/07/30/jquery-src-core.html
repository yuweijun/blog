<!doctype html>




<html class="theme-next mist">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


















  

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<link href="/blog/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">






  <link rel="alternate" href="/blog/atom.xml" title="一" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=5.0.1">






<meta name="description" content="jQuery()方法，这其实是jQuery构造方法的封装，在new关键词漏写时也是正确的返回jquery对象的，看后面关于jQuery.fn.init构造方法说明：">
<meta property="og:type" content="article">
<meta property="og:title" content="jquery-1.4.2 core部分源码分析">
<meta property="og:url" content="http://www.4e00.com/jquery/2014/07/30/jquery-src-core.html">
<meta property="og:site_name" content="一">
<meta property="og:description" content="jQuery()方法，这其实是jQuery构造方法的封装，在new关键词漏写时也是正确的返回jquery对象的，看后面关于jQuery.fn.init构造方法说明：">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-03-06T01:24:26.092Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jquery-1.4.2 core部分源码分析">
<meta name="twitter:description" content="jQuery()方法，这其实是jQuery构造方法的封装，在new关键词漏写时也是正确的返回jquery对象的，看后面关于jQuery.fn.init构造方法说明：">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: false,
    motion: false,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://www.4e00.com/blog/jquery/2014/07/30/jquery-src-core.html">

  <title> jquery-1.4.2 core部分源码分析 | 一 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/blog/" class="brand" rel="start">
      <span class="site-title">一</span>
    </a>
  </div>
  <p class="site-subtitle">{"type":"编程笔记"}</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      <li class="menu-item menu-item-search">
        <a href="https://www.google.com.hk/search?q=site%3Ahttp://www.4e00.com/blog/" class="popup-trigger">
          <i class="menu-item-icon fa fa-search fa-fw"></i>Search
        </a>
      </li>
    </ul>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                jquery-1.4.2 core部分源码分析
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-07-30T21:40:26+08:00" content="2014-07-30">
              2014-07-30
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="//schema.org/Thing">
                  <a href="/blog/categories/jquery/" itemprop="url" rel="index">
                    <span itemprop="name">jquery</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>jQuery()方法，这其实是jQuery构造方法的封装，在new关键词漏写时也是正确的返回jquery对象的，看后面关于jQuery.fn.init构造方法说明：</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Define a local copy of jQuery</span></span><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><span class="line">        <span class="comment">// jQuery.fn.init才是jQuery真正的构造函数，因为后面jQuery.fn.init.prototype = jQuery.fn，所以以后添加到jQuery.fn上的新方法也同样被添加入jQuery.fn.init.prototype上，这里jQuery.fn.init.prototype和jQuery.fn.init这二个对象彼此循环引用了，这个对象循环引用在javascript中很常见，这个不同于方法的循环调用，循环调用就死循环了</span></span><span class="line">        <span class="comment">// javascript中的构造方法可以学习jQuery这个模式来生成object，避免使用new关键字，参考《javascript: The Good Pards》第B.11. new章说明，如果不小心没有用new操作符，也可以正常运行构造函数的，不会报错，但function内的this会指向全局对象，这是javascript语言设计的一个大失误</span></span><span class="line">        <span class="comment">// The jQuery object is actually just the init constructor 'enhanced'</span></span><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );</span><span class="line">    &#125;,</span><span class="line"></span><span class="line">    <span class="comment">// Map over jQuery in case of overwrite</span></span><span class="line">    _jQuery = <span class="built_in">window</span>.jQuery,</span><span class="line"></span><span class="line">    <span class="comment">// Map over the $ in case of overwrite</span></span><span class="line">    _$ = <span class="built_in">window</span>.$,</span><span class="line"></span><span class="line">    <span class="comment">// Use the correct document accordingly with window argument (sandbox)</span></span><span class="line">    <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><span class="line"></span><span class="line">    <span class="comment">// A central reference to the root jQuery(document)</span></span><span class="line">    rootjQuery,</span><span class="line"></span><span class="line">    <span class="comment">// A simple way to check for HTML strings or ID strings</span></span><span class="line">    <span class="comment">// (both of which we optimize for)</span></span><span class="line">    quickExpr = <span class="regexp">/^[^&lt;]*(&lt;[\w\W]+&gt;)[^&gt;]*$|^#([\w-]+)$/</span>,</span><span class="line"></span><span class="line">    <span class="comment">// Is it a simple selector</span></span><span class="line">    isSimple = <span class="regexp">/^.[^:#\[\.,]*$/</span>,</span><span class="line"></span><span class="line">    <span class="comment">// Check if a string has a non-whitespace character in it</span></span><span class="line">    rnotwhite = <span class="regexp">/\S/</span>,</span><span class="line"></span><span class="line">    <span class="comment">// Used for trimming whitespace</span></span><span class="line">    rtrim = <span class="regexp">/^(\s|\u00A0)+|(\s|\u00A0)+$/g</span>,</span><span class="line"></span><span class="line">    <span class="comment">// Match a standalone tag</span></span><span class="line">    rsingleTag = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;)?$/</span>,</span><span class="line"></span><span class="line">    <span class="comment">// Keep a UserAgent string for use with jQuery.browser</span></span><span class="line">    userAgent = navigator.userAgent,</span><span class="line"></span><span class="line">    <span class="comment">// For matching the engine and version of the browser</span></span><span class="line">    browserMatch,</span><span class="line"></span><span class="line">    <span class="comment">// Has the ready events already been bound?</span></span><span class="line">    readyBound = <span class="literal">false</span>,</span><span class="line"></span><span class="line">    <span class="comment">// The functions to execute on DOM ready</span></span><span class="line">    readyList = [],</span><span class="line"></span><span class="line">    <span class="comment">// The ready event handler</span></span><span class="line">    DOMContentLoaded,</span><span class="line"></span><span class="line">    <span class="comment">// Save a reference to some core methods</span></span><span class="line">    toString = <span class="built_in">Object</span>.prototype.toString,</span><span class="line">    hasOwnProperty = <span class="built_in">Object</span>.prototype.hasOwnProperty,</span><span class="line">    push = <span class="built_in">Array</span>.prototype.push,</span><span class="line">    slice = <span class="built_in">Array</span>.prototype.slice,</span><span class="line">    indexOf = <span class="built_in">Array</span>.prototype.indexOf;</span></pre></td></tr></table></figure>
<p><em>jQuery和</em>$二个临时变量保存了window环境中的二个全局同名变量，会在方法中还原临时变量回原来的二个变量，并将当前的jquery对象返回给noConflict()方法调用的结果<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><span class="line">    noConflict: <span class="function"><span class="keyword">function</span>(<span class="params"> deep </span>) </span>&#123;</span><span class="line">        <span class="built_in">window</span>.$ = _$;</span><span class="line"></span><span class="line">        <span class="keyword">if</span> ( deep ) &#123;</span><span class="line">            <span class="built_in">window</span>.jQuery = _jQuery;</span><span class="line">        &#125;</span><span class="line"></span><span class="line">        <span class="keyword">return</span> jQuery;</span><span class="line">    &#125;</span><span class="line">&#125;);</span></pre></td></tr></table></figure></p>
<p>rootjQuery此外只是声明变量，没有初始化，即为undefined，在源码定义完jQuery方法之后才赋值，在使用jQuery方法查找对象时，如果没有传入context，则默认context即为rootjQuery：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// All jQuery objects should point back to these</span></span><span class="line">rootjQuery = jQuery(<span class="built_in">document</span>);</span></pre></td></tr></table></figure>
<p>对于slice 方法，ECMAScript 262 中 15.4.4.10 Array.prototype.slice (start, end) 章节有备注：</p>
<blockquote>
<p>NOTE: The slice function is intentionally generic; it does not require that its this value be an Array object. Therefore it can be transferred to other kinds of objects for use as a method. Whether the slice function can be applied successfully to a host object is implementation-dependent.</p>
</blockquote>
<p>几个正则表达式暂略说明，后面几个Class的实例方法的简写，主要是方便代码书写，其中Array.prototype.slice方法最为常用，将一个类数组的对象转化为真正的array对象，如function中的Arguments对象。</p>
<p>Array.prototype.push方法用得非常巧妙，利用push方法快速构造出一个类数组的object，可查看下面ArrayList的例子说明。</p>
<p>与slice方法一样，push/pop等数组方法也可以用在非数组对象上，15.4.4.7 Array.prototype.push ( [ item1 [ , item2 [ , … ] ] ] )上备注：</p>
<blockquote>
<p>NOTE: The push function is intentionally generic; it does not require that its this value be an Array object. Therefore it can be transferred to other kinds of objects for use as a method. Whether the push function can be applied successfully to a host object is implementation-dependent.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ArrayList = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="comment">// 这里利用Array push快速构造一个类数组的对象</span></span><span class="line">    <span class="comment">// Array push( value, ...) Appends the specified value or values to the end of the array, and returns the new length of the array.</span></span><span class="line">    <span class="built_in">Array</span>.prototype.push.apply(<span class="keyword">this</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">&#125;;</span><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> ArrayList;</span><span class="line">$.<span class="built_in">console</span>.dir(a); <span class="comment">// &#123;0:1, 1:2, 2:3, length:3&#125;</span></span></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ArrayList = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="comment">// 这里利用Array push快速构造一个类数组的对象</span></span><span class="line">    <span class="comment">// Array push( value, ...) Appends the specified value or values to the end of the array, and returns the new length of the array.</span></span><span class="line">    <span class="built_in">Array</span>.prototype.push.apply(<span class="keyword">this</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">&#125;;</span><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> ArrayList;</span><span class="line">$.<span class="built_in">console</span>.dir(a); <span class="comment">// &#123;0:1, 1:2, 2:3, length:3&#125;</span></span></pre></td></tr></table></figure>
<p>重点分析jQuery()方法中的new jQuery.fn.init( selector, context )：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Define a local copy of jQuery</span></span><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><span class="line">        <span class="comment">// The jQuery object is actually just the init constructor 'enhanced'</span></span><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );</span><span class="line">    &#125;</span></pre></td></tr></table></figure>
<p>以下这段代码是在定义完jQuery.fn之后，再将其赋给jQuery.fn.init.prototype的，将所有的jQuery.prototype对象赋给了init的原型链，其中也包括了init方法本身</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// javascript中所有的对象都是通过引用reference操作的，后面通过jQuery.fn.extend()方法添加给jQuery.fn的方法同样也会影响init.prototype</span></span><span class="line"><span class="comment">// 在firebug中的jquery对象中，已经看不到init方法，其实是存在的，不知道是否firebug做过什么处理。</span></span><span class="line"><span class="comment">// 在chrome/safari的console中则可以看到init这个构造方法，并且其prototype链上还有init构造方法。</span></span><span class="line"><span class="comment">// Give the init function the jQuery prototype for later instantiation</span></span><span class="line">jQuery.fn.init.prototype = jQuery.fn;</span></pre></td></tr></table></figure>
<p>jQuery.fn即为jQuery.prototype，查看jQuery.fn.init源码:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 除了代码中所示，select可以是css选择器，DOM元素，HTML字符串，"body"，function之后，还可以是一个数组对象，如果是传入一个数组做为selector，最后通过jQuery.makeArray()方法，将数组转化为一个jquery对象，但此对象的jquery.selector为空字符串</span></span><span class="line">init: <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><span class="line">    <span class="keyword">var</span> match, elem, ret, doc;</span><span class="line"></span><span class="line">    <span class="comment">// Handle $(""), $(null), or $(undefined)</span></span><span class="line">    <span class="keyword">if</span> ( !selector ) &#123;</span><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 处理DOM对象，如果传进来的是DOM对象，而不是CSS选择器之类的字符串，则设置jquery对象的属性之后，返回jquery对象</span></span><span class="line">    <span class="comment">// Handle $(DOMElement)</span></span><span class="line">    <span class="keyword">if</span> ( selector.nodeType ) &#123;</span><span class="line">        <span class="keyword">this</span>.context = <span class="keyword">this</span>[<span class="number">0</span>] = selector;</span><span class="line">        <span class="keyword">this</span>.length = <span class="number">1</span>;</span><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// The body element only exists once, optimize finding it</span></span><span class="line">    <span class="keyword">if</span> ( selector === <span class="string">"body"</span> &amp;&amp; !context ) &#123;</span><span class="line">        <span class="keyword">this</span>.context = <span class="built_in">document</span>;</span><span class="line">        <span class="keyword">this</span>[<span class="number">0</span>] = <span class="built_in">document</span>.body;</span><span class="line">        <span class="keyword">this</span>.selector = <span class="string">"body"</span>;</span><span class="line">        <span class="keyword">this</span>.length = <span class="number">1</span>;</span><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 传进来是字符串，这是最常见的使用方法，通常是传进来CSS选择器和HTML代码片断</span></span><span class="line">    <span class="comment">// Handle HTML strings</span></span><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> selector === <span class="string">"string"</span> ) &#123;</span><span class="line">        <span class="comment">// Are we dealing with HTML string or an ID?</span></span><span class="line">        <span class="comment">// quickExpr = /^[^&lt;]*(&lt;[\w\W]+&gt;)[^&gt;]*$|^#([\w-]+)$/</span></span><span class="line">        <span class="comment">// 如果是HTML代码则会出现配对的&lt;&gt;尖括号，匹配结果的match[1]就不会是undefined</span></span><span class="line">        <span class="comment">// 相反如果是个#id形式的字符串，则match[1]为undefined，match[2]为匹配的ID号</span></span><span class="line">        <span class="comment">// 如果传入的是element TAG NAME的话，则match为null，不会匹配上quickExpr</span></span><span class="line">        <span class="comment">// 这个正则主要是为了提高jquery查询对象的速度</span></span><span class="line">        match = quickExpr.exec( selector );</span><span class="line"></span><span class="line">        <span class="comment">// Verify a match, and that no context was specified for #id</span></span><span class="line">        <span class="keyword">if</span> ( match &amp;&amp; (match[<span class="number">1</span>] || !context) ) &#123;</span><span class="line"></span><span class="line">            <span class="comment">// HANDLE: $(html) -&gt; $(array)</span></span><span class="line">            <span class="keyword">if</span> ( match[<span class="number">1</span>] ) &#123;</span><span class="line">                doc = (context ? context.ownerDocument || context : <span class="built_in">document</span>);</span><span class="line"></span><span class="line">                <span class="comment">// 如果是单标签如&lt;div&gt;或者是&lt;div /&gt;这样，只是在context环境中创建此元素</span></span><span class="line">                <span class="comment">// If a single string is passed in and it's a single tag</span></span><span class="line">                <span class="comment">// just do a createElement and skip the rest</span></span><span class="line">                ret = rsingleTag.exec( selector );</span><span class="line"></span><span class="line">                <span class="keyword">if</span> ( ret ) &#123;</span><span class="line">                    <span class="comment">// jQuery('&lt;a/&gt;', &#123; id: 'foo', href: 'http://www.google.com', title: 'a Googler', rel: 'external', text: 'Google!' &#125;);</span></span><span class="line">                    <span class="keyword">if</span> ( jQuery.isPlainObject( context ) ) &#123;</span><span class="line">                        selector = [ <span class="built_in">document</span>.createElement( ret[<span class="number">1</span>] ) ];</span><span class="line">                        jQuery.fn.attr.call( selector, context, <span class="literal">true</span> );</span><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><span class="line">                        selector = [ doc.createElement( ret[<span class="number">1</span>] ) ];</span><span class="line">                    &#125;</span><span class="line"></span><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><span class="line">                    ret = buildFragment( [ match[<span class="number">1</span>] ], [ doc ] );</span><span class="line">                    selector = (ret.cacheable ? ret.fragment.cloneNode(<span class="literal">true</span>) : ret.fragment).childNodes;</span><span class="line">                &#125;</span><span class="line"></span><span class="line">                <span class="keyword">return</span> jQuery.merge( <span class="keyword">this</span>, selector );</span><span class="line"></span><span class="line">            <span class="comment">// HANDLE: $("#id")</span></span><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><span class="line">                elem = <span class="built_in">document</span>.getElementById( match[<span class="number">2</span>] );</span><span class="line"></span><span class="line">                <span class="keyword">if</span> ( elem ) &#123;</span><span class="line">                    <span class="comment">// 处理IE和Opera中的问题，document.getElementById实际上返回的却是按name查找返回的元素</span></span><span class="line">                    <span class="comment">// Handle the case where IE and Opera return items</span></span><span class="line">                    <span class="comment">// by name instead of ID</span></span><span class="line">                    <span class="keyword">if</span> ( elem.id !== match[<span class="number">2</span>] ) &#123;</span><span class="line">                        <span class="keyword">return</span> rootjQuery.find( selector );</span><span class="line">                    &#125;</span><span class="line"></span><span class="line">                    <span class="comment">// Otherwise, we inject the element directly into the jQuery object</span></span><span class="line">                    <span class="keyword">this</span>.length = <span class="number">1</span>;</span><span class="line">                    <span class="keyword">this</span>[<span class="number">0</span>] = elem;</span><span class="line">                &#125;</span><span class="line"></span><span class="line">                <span class="keyword">this</span>.context = <span class="built_in">document</span>;</span><span class="line">                <span class="keyword">this</span>.selector = selector;</span><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">            &#125;</span><span class="line"></span><span class="line">        <span class="comment">// HANDLE: $("TAG")</span></span><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( !context &amp;&amp; <span class="regexp">/^\w+$/</span>.test( selector ) ) &#123;</span><span class="line">            <span class="keyword">this</span>.selector = selector;</span><span class="line">            <span class="keyword">this</span>.context = <span class="built_in">document</span>;</span><span class="line">            selector = <span class="built_in">document</span>.getElementsByTagName( selector );</span><span class="line">            <span class="keyword">return</span> jQuery.merge( <span class="keyword">this</span>, selector );</span><span class="line"></span><span class="line">        <span class="comment">// 如果context是jquery对象</span></span><span class="line">        <span class="comment">// HANDLE: $(expr, $(...))</span></span><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( !context || context.jquery ) &#123;</span><span class="line">            <span class="keyword">return</span> (context || rootjQuery).find( selector );</span><span class="line"></span><span class="line">        <span class="comment">// 如果context有值并且不是jquery对象时，而是一个CSS选择器</span></span><span class="line">        <span class="comment">// HANDLE: $(expr, context)</span></span><span class="line">        <span class="comment">// (which is just equivalent to: $(context).find(expr)</span></span><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><span class="line">            <span class="keyword">return</span> jQuery( context ).find( selector );</span><span class="line">        &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 当传进来的selector是一个方法时，则此方法会在文档加载完成之后调用，更详细的查看jQuery.ready()方法</span></span><span class="line">    <span class="comment">// HANDLE: $(function)</span></span><span class="line">    <span class="comment">// Shortcut for document ready</span></span><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( jQuery.isFunction( selector ) ) &#123;</span><span class="line">        <span class="keyword">return</span> rootjQuery.ready( selector );</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">if</span> (selector.selector !== <span class="literal">undefined</span>) &#123;</span><span class="line">        <span class="keyword">this</span>.selector = selector.selector;</span><span class="line">        <span class="keyword">this</span>.context = selector.context;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// jQuery.inArray和jQuery.makeArray是二个关于Array的jQuery静态工具方法</span></span><span class="line">    <span class="keyword">return</span> jQuery.makeArray( selector, <span class="keyword">this</span> );</span><span class="line">&#125;</span></pre></td></tr></table></figure>
<p>在jQuery1.4版本中，这个jQuery()核心方法多了以下这种用法：</p>
<blockquote>
<p>Pre 1.4, jQuery supported adding attributes to an element collection via the useful &quot;attr&quot; method, which can be passed both an attribute name and value, or an object specifying several attributes. jQuery 1.4 adds support for passing an attributes object as the second argument to the jQuery function itself, upon element creation.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// examples:</span></span><span class="line">jQuery(<span class="string">'&lt;a/&gt;'</span>, &#123; <span class="attr">id</span>: <span class="string">'foo'</span>, <span class="attr">href</span>: <span class="string">'http://google.com'</span>, <span class="attr">title</span>: <span class="string">'Become a Googler'</span>, <span class="attr">rel</span>: <span class="string">'external'</span>, <span class="attr">text</span>: <span class="string">'Go to Google!'</span> &#125;);</span><span class="line"></span><span class="line">jQuery(<span class="string">'&lt;div/&gt;'</span>, &#123;</span><span class="line">    id: <span class="string">'foo'</span>,</span><span class="line">    css: &#123;</span><span class="line">        fontWeight: <span class="number">700</span>,</span><span class="line">        color: <span class="string">'green'</span></span><span class="line">    &#125;,</span><span class="line">    click: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><span class="line">        alert(<span class="string">'Foo has been clicked!'</span>);</span><span class="line">    &#125;</span><span class="line">&#125;);</span><span class="line"></span><span class="line"><span class="comment">// 第二个例子中的写法，在之前的jQuery版本中则需要用以下写法：</span></span><span class="line">jQuery(<span class="string">'&lt;div/&gt;'</span>)</span><span class="line">.attr(<span class="string">'id'</span>, <span class="string">'foo'</span>)</span><span class="line">.css(&#123;</span><span class="line">    fontWeight: <span class="number">700</span>,</span><span class="line">    color: <span class="string">'green'</span></span><span class="line">&#125;)</span><span class="line">.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><span class="line">    alert(<span class="string">'Foo has been clicked!'</span>);</span><span class="line">&#125;);</span><span class="line"></span><span class="line">$(<span class="string">"&lt;div/&gt;"</span>, &#123;</span><span class="line">  <span class="string">"class"</span>: <span class="string">"test"</span>,</span><span class="line">  text: <span class="string">"Click me!"</span>,</span><span class="line">  click: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><span class="line">    $(<span class="keyword">this</span>).toggleClass(<span class="string">"test"</span>);</span><span class="line">  &#125;</span><span class="line">&#125;).appendTo(<span class="string">"body"</span>);</span><span class="line"></span><span class="line">$(<span class="string">"&lt;input&gt;"</span>, &#123;</span><span class="line">  type: <span class="string">"text"</span>,</span><span class="line">  val: <span class="string">"Test"</span>,</span><span class="line">  focusin: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    $(<span class="keyword">this</span>).addClass(<span class="string">"active"</span>);</span><span class="line">  &#125;,</span><span class="line">  focusout: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    $(<span class="keyword">this</span>).removeClass(<span class="string">"active"</span>);</span><span class="line">  &#125;</span><span class="line">&#125;).appendTo(<span class="string">"form"</span>);</span></pre></td></tr></table></figure>
<p>这个方法的最后是调用jQuery.fn.setArray()方法返回一个类Array的jquery对象：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Force the current matched set of elements to become</span></span><span class="line"><span class="comment">// the specified array of elements (destroying the stack in the process)</span></span><span class="line"><span class="comment">// You should use pushStack() in order to do this, but maintain the stack</span></span><span class="line">setArray: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;</span><span class="line">    <span class="comment">// Resetting the length to 0, then using the native Array push</span></span><span class="line">    <span class="comment">// is a super-fast way to populate an object with array-like properties</span></span><span class="line">    <span class="keyword">this</span>.length = <span class="number">0</span>; <span class="comment">// 清空当前jquery对象中的元素</span></span><span class="line">    push.apply( <span class="keyword">this</span>, elems ); <span class="comment">// 将新的elems数组利用Array.prototype.push方法压入jquery对象中</span></span><span class="line"></span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">&#125;</span></pre></td></tr></table></figure>
<p>如果selector传进来是HTML代码片断时，会调用到DOM操作(manipulation.js)中的buildFragment()方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildFragment</span>(<span class="params"> args, nodes, scripts </span>) </span>&#123;</span><span class="line">    <span class="keyword">var</span> fragment, cacheable, cacheresults,</span><span class="line">        doc = (nodes &amp;&amp; nodes[<span class="number">0</span>] ? nodes[<span class="number">0</span>].ownerDocument || nodes[<span class="number">0</span>] : <span class="built_in">document</span>);</span><span class="line"></span><span class="line">    <span class="comment">// Only cache "small" (1/2 KB) strings that are associated with the main document</span></span><span class="line">    <span class="comment">// Cloning options loses the selected state, so don't cache them</span></span><span class="line">    <span class="comment">// IE 6 doesn't like it when you put &lt;object&gt; or &lt;embed&gt; elements in a fragment</span></span><span class="line">    <span class="comment">// Also, WebKit does not clone 'checked' attributes on cloneNode, so don't cache</span></span><span class="line">    <span class="keyword">if</span> ( args.length === <span class="number">1</span> &amp;&amp; <span class="keyword">typeof</span> args[<span class="number">0</span>] === <span class="string">"string"</span> &amp;&amp; args[<span class="number">0</span>].length &lt; <span class="number">512</span> &amp;&amp; doc === <span class="built_in">document</span> &amp;&amp;</span><span class="line">        !rnocache.test( args[<span class="number">0</span>] ) &amp;&amp; (jQuery.support.checkClone || !rchecked.test( args[<span class="number">0</span>] )) ) &#123;</span><span class="line"></span><span class="line">        cacheable = <span class="literal">true</span>;</span><span class="line">        <span class="comment">// 到jQuery.fragments对象中查找fragement的缓存，如果找到并且其值不为1，则返回缓存中的fragment</span></span><span class="line">        cacheresults = jQuery.fragments[ args[<span class="number">0</span>] ];</span><span class="line">        <span class="keyword">if</span> ( cacheresults ) &#123;</span><span class="line">            <span class="keyword">if</span> ( cacheresults !== <span class="number">1</span> ) &#123;</span><span class="line">                fragment = cacheresults;</span><span class="line">            &#125;</span><span class="line">        &#125;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">if</span> ( !fragment ) &#123;</span><span class="line">        fragment = doc.createDocumentFragment();</span><span class="line">        <span class="comment">// 缓存中没有找到fragment，在jQuery.clean()方法中生成此对象</span></span><span class="line">        <span class="comment">// clean这个方法是为了生成fragment，处理浏览器差异性的javascript DOM操作</span></span><span class="line">        jQuery.clean( args, doc, fragment, scripts );</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">if</span> ( cacheable ) &#123;</span><span class="line">        <span class="comment">// 如果生成的fragment可被缓存，则将之缓存到jQuery.fragments对象中，以备后用</span></span><span class="line">        jQuery.fragments[ args[<span class="number">0</span>] ] = cacheresults ? fragment : <span class="number">1</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">fragment</span>: fragment, <span class="attr">cacheable</span>: cacheable &#125;;</span><span class="line">&#125;</span></pre></td></tr></table></figure>
<p>如果context传进来是一个CSS的selector时，jQuery.fn.init()方法最后调用的是:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> jQuery( context ).find( selector );</span></pre></td></tr></table></figure>
<p>而jQuery.fn.find方法如下，搜索所有与指定表达式匹配的元素，这个函数是找出正在处理的元素的后代元素的好方法，并且可回退到前一个jquery对象：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">find: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;</span><span class="line">    <span class="comment">// jQuery.fn.pushStack()方法会另行说明，这个方法使得jquery对象得以链式操作，是非常巧妙却很简单的方法</span></span><span class="line">    <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="keyword">this</span>.length; i &lt; l; i++ ) &#123;</span><span class="line">        length = ret.length;</span><span class="line">        <span class="comment">// jQuery.find = Sizzle;</span></span><span class="line">        jQuery.find( selector, <span class="keyword">this</span>[i], ret );</span><span class="line"></span><span class="line">        <span class="keyword">if</span> ( i &gt; <span class="number">0</span> ) &#123;</span><span class="line">            <span class="comment">// 查询结果去重</span></span><span class="line">            <span class="comment">// Make sure that the results are unique</span></span><span class="line">            <span class="keyword">for</span> ( <span class="keyword">var</span> n = length; n &lt; ret.length; n++ ) &#123;</span><span class="line">                <span class="keyword">for</span> ( <span class="keyword">var</span> r = <span class="number">0</span>; r &lt; length; r++ ) &#123;</span><span class="line">                    <span class="keyword">if</span> ( ret[r] === ret[n] ) &#123;</span><span class="line">                        ret.splice(n--, <span class="number">1</span>);</span><span class="line">                        <span class="keyword">break</span>;</span><span class="line">                    &#125;</span><span class="line">                &#125;</span><span class="line">            &#125;</span><span class="line">        &#125;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">return</span> ret;</span><span class="line">&#125;</span></pre></td></tr></table></figure>
<p>jQuery.fn中定义的其他一些属性和方法说明：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><span class="line"><span class="comment">// Start with an empty selector</span></span><span class="line">selector: <span class="string">""</span>,</span><span class="line"></span><span class="line"><span class="comment">// The current version of jQuery being used</span></span><span class="line">jquery: <span class="string">"1.4.2"</span>,</span><span class="line"></span><span class="line"><span class="comment">// The default length of a jQuery object is 0</span></span><span class="line">length: <span class="number">0</span>,</span><span class="line"></span><span class="line"><span class="comment">// The number of elements contained in the matched element set</span></span><span class="line">size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.length;</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// 1.4新增加的方法:Retrieve all the DOM elements contained in the jQuery set, as an array.</span></span><span class="line">toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> slice.call( <span class="keyword">this</span>, <span class="number">0</span> );</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// Get the Nth element in the matched element set OR</span></span><span class="line"><span class="comment">// Get the whole matched element set as a clean array</span></span><span class="line"><span class="keyword">get</span>: function( num ) &#123;</span><span class="line">    <span class="keyword">return</span> num == <span class="literal">null</span> ?</span><span class="line"></span><span class="line">        <span class="comment">// 如果jquery.get()方法不传参数，则返回一个DOM对象的集合，真实的array对象</span></span><span class="line">        <span class="comment">// Return a 'clean' array</span></span><span class="line">        <span class="keyword">this</span>.toArray() :</span><span class="line"></span><span class="line">        <span class="comment">// Return just the object</span></span><span class="line">        ( num &lt; <span class="number">0</span> ? <span class="keyword">this</span>.slice(num)[ <span class="number">0</span> ] : <span class="keyword">this</span>[ num ] );</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// 这个方法使得jquery对象可以链式进行操作，结合jQuery.fn.end方法回退到前一个jquery对象上</span></span><span class="line"><span class="comment">// Take an array of elements and push it onto the stack</span></span><span class="line"><span class="comment">// (returning the new matched element set)</span></span><span class="line">pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, name, selector </span>) </span>&#123;</span><span class="line">    <span class="comment">// Build a new jQuery matched element set</span></span><span class="line">    <span class="keyword">var</span> ret = jQuery();</span><span class="line"></span><span class="line">    <span class="keyword">if</span> ( jQuery.isArray( elems ) ) &#123;</span><span class="line">        push.apply( ret, elems );</span><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><span class="line">        <span class="comment">// 将第2个参数中的数组元素追加到ret中，在后面数组的jQuery方法里说明</span></span><span class="line">        jQuery.merge( ret, elems );</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 将当前的jquery对象，做为新查询得到的jquery对象ret的前一个对象</span></span><span class="line">    <span class="comment">// Add the old object onto the stack (as a reference)</span></span><span class="line">    ret.prevObject = <span class="keyword">this</span>;</span><span class="line"></span><span class="line">    ret.context = <span class="keyword">this</span>.context;</span><span class="line"></span><span class="line">    <span class="comment">// 如果没有name传入，则不设置selector</span></span><span class="line">    <span class="keyword">if</span> ( name === <span class="string">"find"</span> ) &#123;</span><span class="line">        <span class="comment">// 如果是find方法，则构造一个CSS子选择器</span></span><span class="line">        ret.selector = <span class="keyword">this</span>.selector + (<span class="keyword">this</span>.selector ? <span class="string">" "</span> : <span class="string">""</span>) + selector;</span><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( name ) &#123;</span><span class="line">        <span class="comment">// 举例name为slice筛选方法，selector为"-1"</span></span><span class="line">        ret.selector = <span class="keyword">this</span>.selector + <span class="string">"."</span> + name + <span class="string">"("</span> + selector + <span class="string">")"</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 返回新jquery对象</span></span><span class="line">    <span class="comment">// Return the newly-formed element set</span></span><span class="line">    <span class="keyword">return</span> ret;</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// Execute a callback for every element in the matched set.</span></span><span class="line"><span class="comment">// (You can seed the arguments with an array of args, but this is only used internally.)</span></span><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// 当DOM就绪就会调用fn，并传入document, jQuery这二个参数</span></span><span class="line"><span class="comment">// 如果没有就绪则记录到readList数组中，在DOM就绪后会被逐个执行</span></span><span class="line">ready: <span class="function"><span class="keyword">function</span>(<span class="params"> fn </span>) </span>&#123;</span><span class="line">    <span class="comment">// Attach the listeners</span></span><span class="line">    jQuery.bindReady();</span><span class="line"></span><span class="line">    <span class="comment">// If the DOM is already ready</span></span><span class="line">    <span class="keyword">if</span> ( jQuery.isReady ) &#123;</span><span class="line">        <span class="comment">// Execute the function immediately</span></span><span class="line">        fn.call( <span class="built_in">document</span>, jQuery );</span><span class="line"></span><span class="line">    <span class="comment">// Otherwise, remember the function for later</span></span><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( readyList ) &#123;</span><span class="line">        <span class="comment">// Add the function to the wait list</span></span><span class="line">        readyList.push( fn );</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// 此方法返回一个新的过滤后的jquery对象，与get()方法不同，get()方法是返回指定的DOM对象</span></span><span class="line">eq: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> i === <span class="number">-1</span> ?</span><span class="line">        <span class="keyword">this</span>.slice( i ) :</span><span class="line">        <span class="keyword">this</span>.slice( i, +i + <span class="number">1</span> );</span><span class="line">&#125;,</span><span class="line"></span><span class="line">first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.eq( <span class="number">0</span> );</span><span class="line">&#125;,</span><span class="line"></span><span class="line">last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.eq( <span class="number">-1</span> );</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// jQuery.fn.slice()方法返回Array.prototype.slice.apply(this, arguments)这个新的jquery对象</span></span><span class="line">slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( slice.apply( <span class="keyword">this</span>, <span class="built_in">arguments</span> ),</span><span class="line">        <span class="string">"slice"</span>, slice.call(<span class="built_in">arguments</span>).join(<span class="string">","</span>) );</span><span class="line">&#125;,</span><span class="line"></span><span class="line">map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><span class="line">    <span class="comment">// 没有给pushStack方法传入name，所以map产生的jquery对象没有selector值</span></span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><span class="line">        <span class="keyword">return</span> callback.call( elem, i, elem );</span><span class="line">    &#125;));</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// 与pushStack方法相对应，可回退到前一个jquery对象上，官方文档解释为：</span></span><span class="line"><span class="comment">// End the most recent filtering operation in the current chain and return the set of matched elements to its previous state</span></span><span class="line"><span class="comment">// If there was no destructive operation before, an empty set is returned.</span></span><span class="line"><span class="comment">// A 'destructive' operation is any operation that changes the set of matched jQuery elements,</span></span><span class="line"><span class="comment">// which means any Traversing function that returns a jQuery object - including</span></span><span class="line"><span class="comment">// 'add', 'andSelf', 'children', 'filter', 'find', 'map', 'next', 'nextAll', 'not', 'parent', 'prevUntil', 'parentUntil', 'nextUntil',</span></span><span class="line"><span class="comment">// 'parents', 'prev', 'prevAll', 'siblings' and 'slice' - plus the 'clone' function (from Manipulation).</span></span><span class="line">end: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.prevObject || jQuery(<span class="literal">null</span>);</span><span class="line">&#125;,</span><span class="line"></span><span class="line"><span class="comment">// For internal use only.</span></span><span class="line"><span class="comment">// Behaves like an Array's method, not like a jQuery method.</span></span><span class="line">push: push,</span><span class="line">sort: [].sort,</span><span class="line">splice: [].splice</span></pre></td></tr></table></figure>
<p>jquery对象的selector是后来版本中加上的，是为了方便插件开发人员从jquery对象中拿到selector。</p>
<p>jquery属性是指当前jQuery的版本号。</p>
<p>length指明当前jquery对象中包括的DOM对象数量，这个值会被Array.prototype.push方法自动设置。</p>
<p>toArray()方法是将jquery对象转化为一个真实数组。这里调用了Array.prototype.slice方法。</p>
<p>get()方法是返回当前jquery对象中的某个DOM对象，支持负数做为参数，从数组末尾开始查找对象。</p>
<p>get()方法里用到了jQuery.fn.slice方法，这是jQuery的一个筛选方法，与jQuery.fn.find方法性质一样，需要说明的是Array.prototype.slice方法：</p>
<blockquote>
<p>start可以为负数，从start位置开始到end位置，并且end位置的值不包括进来，数据位置是以0开始计数的。</p>
<p>slice(start, end): Returns a new array that contains the elements of the array from the element numbered start, up to, but not including, the element numbered end.</p>
</blockquote>
<p>jQuery.fn.each方法是用于遍历jquery对象中DOM对象，代码实际是调用了jQuery静态工具方法jQuery.each，这里不细说明此方法。</p>
<p>jQuery.fn.index方法是找到当前jquery对象的第一个DOM对象，在根据selector找到的jquery对象中的位置，<br>其中用到 jQuery.inArray 这个jQuery的数组方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 确定第一个参数在数组中的位置(如果没有找到则返回 -1 )。</span></span><span class="line">inArray: <span class="function"><span class="keyword">function</span>(<span class="params"> elem, array </span>) </span>&#123;</span><span class="line">    <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, length = array.length; i &lt; length; i++ ) &#123;</span><span class="line">        <span class="keyword">if</span> ( array[ i ] === elem ) &#123;</span><span class="line">            <span class="keyword">return</span> i;</span><span class="line">        &#125;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><span class="line">&#125;,</span></pre></td></tr></table></figure>
<p>jQuery.fn.is方法是用一个表达式来检查当前选择的元素集合，如果其中至少有一个元素符合这个给定的表达式就返回true，见后面的inputs.parent().is(&#39;form&#39;)例子。</p>
<p>jQuery.filter方法最后是调用Sizzle，关于Sizzle另外再详细分析。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery.filter = jQuery.multiFilter = <span class="function"><span class="keyword">function</span>(<span class="params"> expr, elems, not </span>) </span>&#123;</span><span class="line">    <span class="keyword">if</span> ( not ) &#123;</span><span class="line">        expr = <span class="string">":not("</span> + expr + <span class="string">")"</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">return</span> Sizzle.matches(expr, elems);</span><span class="line">&#125;;</span></pre></td></tr></table></figure>
<p>jQuery核心方法extend，可以通过此方法给对象添加新属性和方法，也可以通过此方法给jQuery添加静态方法，为jquery对象添加新方法，可利用extend为jQuery写插件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><span class="line">    <span class="comment">// copy reference to target object</span></span><span class="line">    <span class="keyword">var</span> target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;, i = <span class="number">1</span>, length = <span class="built_in">arguments</span>.length, deep = <span class="literal">false</span>, options, name, src, copy;</span><span class="line"></span><span class="line">    <span class="comment">// 如果第一个参数是true/false，则表示是否是深拷贝对象，并且调整target为第二个参数</span></span><span class="line">    <span class="comment">// Handle a deep copy situation</span></span><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</span><span class="line">        deep = target;</span><span class="line">        target = <span class="built_in">arguments</span>[<span class="number">1</span>] || &#123;&#125;;</span><span class="line">        <span class="comment">// skip the boolean and the target</span></span><span class="line">        i = <span class="number">2</span>;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></span><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target) ) &#123;</span><span class="line">        target = &#123;&#125;;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 如果传进来只有一个参数或者是一个参数加上true/false时，扩展jQuery本身</span></span><span class="line">    <span class="comment">// extend jQuery itself if only one argument is passed</span></span><span class="line">    <span class="keyword">if</span> ( length === i ) &#123;</span><span class="line">        target = <span class="keyword">this</span>;</span><span class="line">        --i;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><span class="line">        <span class="comment">// Only deal with non-null/undefined values</span></span><span class="line">        <span class="keyword">if</span> ( (options = <span class="built_in">arguments</span>[ i ]) != <span class="literal">null</span> ) &#123;</span><span class="line">            <span class="comment">// Extend the base object</span></span><span class="line">            <span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><span class="line">                src = target[ name ];</span><span class="line">                copy = options[ name ];</span><span class="line"></span><span class="line">                <span class="comment">// javascript的对象是通过引用操作的，防止自身引用自身造成死循环</span></span><span class="line">                <span class="comment">// Prevent never-ending loop</span></span><span class="line">                <span class="keyword">if</span> ( target === copy ) &#123;</span><span class="line">                    <span class="keyword">continue</span>;</span><span class="line">                &#125;</span><span class="line"></span><span class="line">                <span class="comment">// 不对DOM对象进行深拷贝操作</span></span><span class="line">                <span class="comment">// Recurse if we're merging object literal values or arrays</span></span><span class="line">                <span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) || jQuery.isArray(copy) ) ) &#123;</span><span class="line">                    <span class="keyword">var</span> clone = src &amp;&amp; ( jQuery.isPlainObject(src) || jQuery.isArray(src) ) ? src</span><span class="line">                        : jQuery.isArray(copy) ? [] : &#123;&#125;;</span><span class="line"></span><span class="line">                    <span class="comment">// 这里调用了jQuery.extend静态方法，如果是给jQuery本身扩展，那这里就是个递归方法调用</span></span><span class="line">                    <span class="comment">// Never move original objects, clone them</span></span><span class="line">                    target[ name ] = jQuery.extend( deep, clone, copy );</span><span class="line"></span><span class="line">                <span class="comment">// Don't bring in undefined values</span></span><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><span class="line">                    target[ name ] = copy;</span><span class="line">                &#125;</span><span class="line">            &#125;</span><span class="line">        &#125;</span><span class="line">    &#125;</span><span class="line"></span><span class="line">    <span class="comment">// 返回第一个对象参数，可能是jQuery/jQuery.fn</span></span><span class="line">    <span class="comment">// Return the modified object</span></span><span class="line">    <span class="keyword">return</span> target;</span><span class="line">&#125;;</span></pre></td></tr></table></figure>
<p>这个方法的官方文档说明比较详细，其中几个例子在此页面有测试：</p>
<blockquote>
<p>jQuery.extend( target, [ object1 ], [ objectN ] ) Returns: Object</p>
<p>version added: 1.0</p>
<p>Description: Merge the contents of two or more objects together into the first object.</p>
<p>jQuery.extend( target, [ object1 ], [ objectN ] )</p>
<p>version added: 1.1.4</p>
<p>target: An object that will receive the new properties if additional objects are passed in or that will extend the jQuery namespace if it is the sole argument.</p>
<p>object1: An object containing additional properties to merge in.</p>
<p>objectN: Additional objects containing properties to merge in.</p>
<p>jQuery.extend( [ deep ], target, object1, [ objectN ] )</p>
<p>deep: If true, the merge becomes recursive (aka. deep copy).</p>
<p>target: The object to extend. It will receive the new properties.</p>
<p>object1: An object containing additional properties to merge in.</p>
<p>objectN: Additional objects containing properties to merge in.</p>
<p>When we supply two or more objects to $.extend(), properties from all of the objects are added to the target object.</p>
<p>If only one argument is supplied to $.extend(), this means the target argument was omitted. In this case, the jQuery object itself is assumed to be the target. By doing this, we can add new functions to the jQuery namespace. This can be useful for plugin authors wishing to add new methods to JQuery.</p>
<p>Keep in mind that the target object (first argument) will be modified, and will also be returned from $.extend(). If, however, we want to preserve both of the original objects, we can do so by passing an empty object as the target:</p>
<p>var object = $.extend({}, object1, object2);</p>
<p>The merge performed by $.extend() is not recursive by default; if a property of the first object is itself an object or array, it will be completely overwritten by a property with the same key in the second object. The values are not merged. This can be seen in the example below by examining the value of banana. However, by passing true for the first function argument, objects will be recursively merged.</p>
<p>Undefined properties are not copied. However, properties inherited from the object&#39;s prototype will be copied over.</p>
<p>Examples:</p>
<p>Example: Merge two objects, modifying the first.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> object1 = &#123;</span><span class="line">  apple: <span class="number">0</span>,</span><span class="line">  banana: &#123;<span class="attr">weight</span>: <span class="number">52</span>, <span class="attr">price</span>: <span class="number">100</span>&#125;,</span><span class="line">  cherry: <span class="number">97</span></span><span class="line">&#125;;</span><span class="line"><span class="keyword">var</span> object2 = &#123;</span><span class="line">  banana: &#123;<span class="attr">price</span>: <span class="number">200</span>&#125;,</span><span class="line">  durian: <span class="number">100</span></span><span class="line">&#125;;</span><span class="line">$.extend(object1, object2);</span></pre></td></tr></table></figure>
<p>Result:</p>
<p>object1 === {apple: 0, banana: {price: 200}, cherry: 97, durian: 100}</p>
<p>Example: Merge two objects recursively, modifying the first.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> object1 = &#123;</span><span class="line">  apple: <span class="number">0</span>,</span><span class="line">  banana: &#123;<span class="attr">weight</span>: <span class="number">52</span>, <span class="attr">price</span>: <span class="number">100</span>&#125;,</span><span class="line">  cherry: <span class="number">97</span></span><span class="line">&#125;;</span><span class="line"><span class="keyword">var</span> object2 = &#123;</span><span class="line">  banana: &#123;<span class="attr">price</span>: <span class="number">200</span>&#125;,</span><span class="line">  durian: <span class="number">100</span></span><span class="line">&#125;;</span><span class="line">$.extend(<span class="literal">true</span>, object1, object2);</span></pre></td></tr></table></figure>
<p>Result:</p>
<p>object1 === {apple: 0, banana: {weight: 52, price: 200}, cherry: 97, durian: 100}</p>
<p>Example: Merge settings and options, modifying settings.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123; <span class="attr">validate</span>: <span class="literal">false</span>, <span class="attr">limit</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">"foo"</span> &#125;;</span><span class="line"><span class="keyword">var</span> options = &#123; <span class="attr">validate</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"bar"</span> &#125;;</span><span class="line">jQuery.extend(settings, options);</span></pre></td></tr></table></figure>
<p>Result:</p>
<p>settings == { validate: true, limit: 5, name: &quot;bar&quot; }</p>
<p>Example: Merge defaults and options, without modifying the defaults. This is a common plugin development pattern.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> empty = &#123;&#125;</span><span class="line"><span class="keyword">var</span> defaults = &#123; <span class="attr">validate</span>: <span class="literal">false</span>, <span class="attr">limit</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">"foo"</span> &#125;;</span><span class="line"><span class="keyword">var</span> options = &#123; <span class="attr">validate</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"bar"</span> &#125;;</span><span class="line"><span class="keyword">var</span> settings = $.extend(empty, defaults, options);</span></pre></td></tr></table></figure>
<p>Result:</p>
<p>settings == { validate: true, limit: 5, name: &quot;bar&quot; }</p>
<p>empty == { validate: true, limit: 5, name: &quot;bar&quot; }</p>
</blockquote>
<p>更多关于jQuery通过extend方法添加进来的静态方法，可查看关于静态方法部分的源码分析</p>
<blockquote>
<p>ID-Based Selectors: Beginning your selector with an ID is always best.</p>
<p>The $.fn.find approach is faster because the first selection is handled without going through the Sizzle selector engine - ID-only selections are handled using document.getElementById(), which is extremely fast because it is native to the browser.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// fast</span></span><span class="line">$(<span class="string">'#container div.robotarm'</span>);</span><span class="line"></span><span class="line"><span class="comment">// super-fast</span></span><span class="line">$(<span class="string">'#container'</span>).find(<span class="string">'div.robotarm'</span>);</span></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/jquery/2014/07/30/jquery-src-attribute.html" rel="next" title="jquery-1.4.2 attribute部分源码分析">
                <i class="fa fa-chevron-left"></i>
                jquery-1.4.2 attribute部分源码分析
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/jquery/2014/07/31/jquery-console-debug-plugin.html" rel="prev" title="jquery debug plugin">
                <i class="fa fa-chevron-right"></i>
                jquery debug plugin
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/blog/images/avatar.jpg" alt="yuweijun">
          <p class="site-author-name" itemprop="name">yuweijun</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/blog/archives">
              <span class="site-state-item-count">492</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/blog/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yuweijun" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/yuweijun" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">This post does not have a Table of Contents</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-github"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuweijun</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist.KISS
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>











  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>

  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.3.1/velocity.min.js"></script>

  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.3.1/velocity.ui.min.js"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
